/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }(); // ==UserScript==
// @name         Banner
// @path         //./src/banner/variant.js
// @namespace    http://tampermonkey.net/
// @version      0.1
// @match        https://www.ica.se/*
// @grant        none
// ==/UserScript==

var _main = __webpack_require__(2);

var _style = __webpack_require__(1);

(function ($) {
  'use strict';
  // hj && hj('trigger', 'variant2');// eslint-disable-line

  var test = {
    addStyles: function addStyles() {
      return _style.styles;
    },
    printBanner: function printBanner(content, _ref) {
      var title = _ref.title,
          discount = _ref.discount,
          preamble = _ref.preamble,
          url = _ref.url,
          img = _ref.img;

      var _$ELM$create = _main.$ELM.create('banner', 'banner-row', 'banner-column', 'banner-column grow-one', 'banner-column', 'banner-column__image', 'h1', 'span', 'p', 'img', 'a', 'a .button download'),
          _$ELM$create2 = _slicedToArray(_$ELM$create, 12),
          bannerElement = _$ELM$create2[0],
          bannerRow = _$ELM$create2[1],
          bannerColumn1 = _$ELM$create2[2],
          bannerColumn2 = _$ELM$create2[3],
          bannerColumn3 = _$ELM$create2[4],
          imgElement = _$ELM$create2[5],
          titleElement = _$ELM$create2[6],
          discountElement = _$ELM$create2[7],
          preambleElement = _$ELM$create2[8],
          imgHolder = _$ELM$create2[9],
          readMore = _$ELM$create2[10],
          downLoad = _$ELM$create2[11];

      imgHolder.image(img);
      imgElement.append(imgHolder);

      readMore.href(url).text('LÃ¤s mer');
      downLoad.href(url).text('Ladda ner');

      titleElement.html(title);
      discountElement.html(discount);
      preambleElement.html(preamble);

      bannerColumn1.append(imgElement);
      bannerColumn2.appendAll(titleElement, discountElement, preambleElement, readMore);
      bannerColumn3.append(downLoad);

      bannerRow.appendAll(bannerColumn1, bannerColumn2, bannerColumn3);
      bannerElement.append(bannerRow);
      content.append(bannerElement);
    },
    loadBanners: function loadBanners(ids, content) {
      var _this = this;

      ids.forEach(function (id) {
        _this.load('https://www.ica.se/api/jsonhse/' + id, { credentials: 'same-origin' }).then(function (response) {
          return response.json();
        }).then(function (response) {
          var Header = response.Header,
              Offer = response.Offer;
          var OfferCondition = Offer.OfferCondition,
              Brand = Offer.Brand,
              SizeOrQuantity = Offer.SizeOrQuantity;

          _this.printBanner(content, {
            title: Header,
            discount: OfferCondition.Conditions[0],
            preamble: Brand + ' ' + SizeOrQuantity.Text,
            url: '',
            img: Offer.Image.ImageUrl
          });
        });
      });
    },
    manipulateDom: function manipulateDom() {
      var content = _main.$ELM.get('#content');
      var regexp = /www.ica.se\/kampanj\/hse/g;
      var banners = this.getElementContentByTagAndAttr(regexp, 'a', 'href');
      var ids = banners.map(function (banner) {
        return banner.match(/\d+$/)[0];
      });
      content.html(' ');
      this.loadBanners(ids, content);
    }
  };

  $(document).ready(function () {
    Object.assign(test, (0, _main.ICACRO)());
    test.style(test.addStyles());
    test.manipulateDom();
  });
})(jQuery);

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});
var styles = exports.styles = "\n.cro .grow-one { flex-grow: 1; }\n.cro .banner { display:flex; background-color: #F8EBF3; margin-bottom: 10px; }\n.cro .banner-row {\ndisplay:flex;\nwidth:100%;\nalign-items: center;\nbackground-color: white;\nmargin: 10px 15px;\nmin-height: 133px;\nposition: relative;\n}\n.cro .banner-row::after {\nbackground:url(\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIxLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxMCAyMCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTAgMjA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojRjhFQkYzO30KPC9zdHlsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTIuNDk3MDIxLDkuOTg4ODA3YzAsNC4xNDIxNTEsMy4zNTc4NDksNy41MDAwMDEsNy41LDcuNTAwMDAxdi0xNQoJQzUuODU0ODcsMi40ODg4MDcsMi40OTcwMjEsNS44NDY2NTYsMi40OTcwMjEsOS45ODg4MDd6Ii8+Cjwvc3ZnPgo=\") space;\nbackground-size: 13px 26px;\nbottom: 0;\ncontent: '';\ndisplay: block;\nheight: 100%;\nposition: absolute;\nright: 0;\ntop: 0;\nwidth: 13px;\n}\n.cro .banner .banner-column { padding: 10px 10px; }\n.cro .banner .banner-column .download {\nalign-items: center;\nbackground: #F8EBF3;\ncolor: #A02971;\ncursor: pointer;\ndisplay: flex;\nflex-direction: column;\njustify-content: center;\nmargin: 10px 10px 10px 0;\nborder-radius: 5rem;\n}\n.cro .banner .banner-column h1 { font-size: 1.6rem; }\n.cro .banner .banner-column span {\ncolor: #EB1F07;\nfont-family: icarubrik;\nfont-size: 2.2rem;\nfont-weight: bold;\n}\n.cro .banner .banner-column p {\ncolor: #808283;\nfont-size: 1.3rem;\n}\n.cro .banner .banner-column .banner-column__more-info { font-size: 20px; }\n.cro .banner-column__image img {\nmax-width: 140px;\nmax-height: 140px;\n}\n@media only screen and (max-width: 780px){\n.cro .banner-column__image img {\nmax-width: 80px;\nmax-height: 100px;\n}\n#page {\npadding: 0 5px 5px;\n}\n.cro .banner .banner-column .download {\nborder-radius: 2rem;\n}\n}\n";

/***/ }),
/* 2 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
const reservedElements = ['body', 'head', 'img', 'style', 'span', 'ul', 'li', 'input', 'button', 'h1', 'h2', 'h3', 'h4', 'a', 'p', 'strong', 'svg'];

const $ELM_ELEMENT = element => {
  return {
    attr(type, value) {
      if (value) {
        element.setAttribute(type, value);
        return this;
      }
      return element.getAttribute(type);
    },
    html(str) {
      if (!str) return element.innerHTML;
      element.innerHTML = str;
      return this;
    },
    text(str) {
      if (!str) return element.innerHTML;
      element.innerHTML = '';
      element.appendChild(document.createTextNode(str));
      return this;
    },
    image(src) {
      element.src = src;
      return this;
    },
    href(url) {
      element.href = url;
      return this;
    },
    append(child) {
      const c = child.nodeType ? child : child.element;
      element.appendChild(c);
      return this;
    },
    appendAll(...childs) {
      return childs.map(this.append);
    },
    css(cn) {
      if (cn) {
        cn.split(' ').join(',').split(',').forEach(c => c && element.classList.add(c.replace(/\./g, '').trim()));
      }
      return this;
    },
    style(stl) {
      Object.assign(element.style, stl);
      return this;
    },
    element
  };
};

const GetElement = selector => document.querySelector(selector);

const CreateElement = arg => {
  const arr = arg.split(' ');
  const type = arr.reduce((acc, current) => {
    if (reservedElements.includes(current)) {
      return current;
    }
    return acc;
  }, 'div');
  const isReserved = reservedElements.some(el => el === type);
  const classNames = arr.filter(current => !reservedElements.includes(current)).join();
  return $ELM_ELEMENT(document.createElement(type)).css(classNames);
};

const CreateElementByObject = (type, iterable) => {
  const element = CreateElement(type);
  for (const item in iterable) {
    if (element[item]) {
      const value = iterable[item];
      if (value && value.length) {
        element[item](value);
      }
    }
  }
  return element;
};

const $ELM = {
  create(...args) {
    if (args.length === 1) return CreateElement(args[0]);
    return args.map(arg => CreateElement(arg));
  },
  build(type, iterable) {
    return CreateElementByObject(type, iterable);
  },
  get(args) {
    if (typeof args === 'string') return $ELM_ELEMENT(GetElement(args));
    return args.map(arg => $ELM_ELEMENT(GetElement(arg)));
  }
};
/* harmony export (immutable) */ __webpack_exports__["$ELM"] = $ELM;


const ICACRO = name => {
  $ELM.get('body').css('cro');
  return {
    getElementContentByTagAndAttr(regexp, tag, attr) {
      const elements = document.querySelectorAll(tag);
      return this.toArray(elements).reduce((acc, element) => {
        if (new RegExp(regexp).test(element[attr])) {
          acc.push(element[attr]);
        }
        return acc;
      }, []);
    },
    removeElements(classNames) {
      classNames.forEach(className => {
        const elm = document.querySelector(className);
        if (elm instanceof HTMLElement) elm.parentNode.removeChild(elm);
      });
    },
    toArray(list) {
      return Array.prototype.slice.call(list);
    },
    load() {
      const [url, options] = arguments;
      const ops = Object.assign({}, { method: 'get' }, options);
      return fetch(url, ops).then(response => {
        return response;
      }).catch(err => {
        console.log(err);
        return err;
      });
    },
    style(styles) {
      const style = $ELM.create('style');
      style.attr('type', 'text/css');
      style.append(document.createTextNode(styles));
      $ELM.get('head').append(style);
    },
    isLoggedIn() {
      return $ELM.get('#hdnIcaState').attr('value') ? true : false;
    }
  };
};
/* harmony export (immutable) */ __webpack_exports__["ICACRO"] = ICACRO;


/***/ })
/******/ ]);